(function(a) {
    const b = {
        isUserCreated: !1,
        headerPrevButton: '#wpforms-page-prev--header a',
        calendlyUrl: '',
        init: function() {
            this.afterUserFormPage(), this.onHeaderPrevButtonClick(), this.onPageChange(), this.setMarketingCode()
        },
        afterUserFormPage: function() {
            a(document).on('wpformsBeforePageChange', '.consultation-form', this.onUserRegistration)
        },
        registerUser: function(d, e, c, f, g) {
            if (!b.isUserCreated && !a('body').hasClass('logged-in')) {
                d.preventDefault();
                const i = b.getCurrentPage(),
                    h = c.find(`.wpforms-page-${i} .wpforms-page-next`),
                    j = h.text();
                h.text('Processing...').attr('disabled', 'disabled');
                const k = {
                        sp_wpform_ajax_nonce: sp_wpform.ajax_nonce,
                        action: sp_wpform.action
                    },
                    l = { ...k,
                        ...g
                    };
                a.ajax({
                    type: 'post',
                    url: sp_wpform.ajax_url,
                    dataType: 'json',
                    data: l,
                    success: function(g) {
                        g.success ? ($page = c.find(`.wpforms-page-${i}`).next(), b.isUserCreated = !0, wpforms.navigateToPage(a(d.target), f, e - 1, c, $page)) : alert(g.data.message)
                    },
                    complete: function() {
                        h.text(j).removeAttr('disabled')
                    }
                })
            }
        },
        onUserRegistration: function(d, e, a, f) {
            const c = b.getUserDetails(a);
            c && b.registerUser(d, e, a, f, c)
        },
        getUserDetails: function(c) {
            const d = b.getCurrentPage(),
                a = c.find(`.wpforms-page-${d}`);
            return !!a.find('.wpforms-field-email input').val() && {
                email: a.find('.wpforms-field-email input').val(),
                first_name: a.find('.sp-wpforms-first-name input').val(),
                last_name: a.find('.sp-wpforms-last-name input').val(),
                phone: a.find('.wpforms-field-phone input').val(),
                password: a.find('.wpforms-field-password input[type="password"]').val()
            }
        },
        setLastPage: function(b) {
            a('.sp-wform-last-page').find('input').val(b)
        },
        getCurrentPage: function() {
            const b = parseInt(a('.wpforms-page-indicator').attr('aria-valuenow'));
            return b ? ? 1
        },
        getPagePreviousButtonElement: function(b) {
            return a(`.wpforms-page-${b}`).find('.wpforms-page-prev')
        },
        onPageChange: function() {
            a(document).on('wpformsPageChange', '.consultation-form .wpforms-form', function(c, a, d, e) {
                b.toggleHeaderPreviousButtonElement(c, a, d, e), b.setResumeLinkEmail(c, a, d, e), b.setLastPage(a)
            })
        },
        onHeaderPrevButtonClick: function() {
            a(this.headerPrevButton).length && a(this.headerPrevButton).on('click', function(c) {
                c.preventDefault();
                const d = b.getCurrentPage(),
                    a = b.getPagePreviousButtonElement(d);
                a && a.trigger('click')
            })
        },
        toggleHeaderPreviousButtonElement: function(d, c, e, f) {
            b.getPagePreviousButtonElement(c).length ? a(b.headerPrevButton).addClass('is-active') : a(b.headerPrevButton).removeClass('is-active')
        },
        setResumeLinkEmail: function(c, d, b, e) {
            a('[name="wpforms[save_resume_email]"]').val(b.find('.wpforms-field-email input[type="email"]').val())
        },
        getCalendlyUrl: function() {
            const e = a('.sp-wpforms-calendly-url input'),
                c = b.getUserDetails(a('.consultation-form .wpforms-form')),
                f = new URL(e.val()),
                d = new SearchParams(f.search);
            return d.SearchParams.set('name', `${c.first_name} ${c.last_name}`), d.SearchParams.set('email', encodeURI(c.email)), d.SearchParams.set('location', c.phone), decodeURI(d.href)
        },
        handleCalendlyButtonClick: function() {
            a(document).on('click', '.sp-wpforms-book-consultation-btn', function(a) {
                return a.preventDefault(), Calendly.initPopupWidget({
                    url: b.getCalendlyUrl()
                }), !1
            })
        },
        getMarketingCode: function() {
            return localStorage.getItem('fid')
        },
        setMarketingCode: function() {
            const b = this.getMarketingCode(),
                c = a('.marketing-code input');
            if (!c.length && (b != '' || !b)) return;
            c.val(b)
        }
    };
    a(document).ready(function() {
        b.init()
    })
})(jQuery)